{% extends "base.html" %}

{% block pagetitle %}
    <div class="page-title-alt-bg"></div>
    <div class="row">
        <div class="col-md-12">
            <div class="card-box">
                <h4 class="header-title m-t-0 m-b-30">大盘分析-大盘指数</h4>

                <ul class="nav nav-pills navtab-bg nav-justified">
                    <li class="nav-item">
                        <a id="999999" href="/dpfx_dpzs/999999" aria-expanded="false" class="nav-link">
                            上证指数
                        </a>
                    </li>
                    <li class="nav-item">
                        <a id="399001" href="/dpfx_dpzs/399001" aria-expanded="false" class="nav-link">
                            深证指数
                        </a>
                    </li>
                    <li class="nav-item">
                        <a id="399005" href="/dpfx_dpzs/399005" aria-expanded="false" class="nav-link">
                            中小板指
                        </a>
                    </li>
                    <li class="nav-item">
                        <a id="399006" href="/dpfx_dpzs/399006" aria-expanded="false" class="nav-link">
                            创业板指
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="" aria-expanded="false" class="nav-link">
                            大盘咨询
                        </a>
                    </li>
                </ul>
            </div> <!-- end card-box-->
        </div>
    </div>
{% endblock %}
{% block content %}
    <div class="row">

        <div class="col-1"></div>
        <div class="col-2">
            <div class="row">
                <div class="nav flex-column nav-pills nav-pills-tab" id="date_tab" role="tablist"
                     aria-orientation="vertical">

                </div>
            </div> <!-- end row-->


        </div>
        <div class="col-8">
            <div class="row">
                <div class="col-8"></div>

            </div>
            <div id="zshq" class="stock_info" style="width:100%;height:500px;">
                <table class="stock_detail" style="table-layout:fixed;">
                    <tbody>
                    <tr>
                        <td style="font-size: 28px; color: #3fa1c6;line-height:30px; font-weight: bold; text-align:center;">
                            上证指数<br/><span style="font-size: 24px;">999999</span></td>
                        <td style="width:145px;color: #008000">涨幅：<strong class="cGreen">-0.34%</strong><br/>今收：<strong
                                class="cGreen">2751.80</strong></td>
                        <td style="width:145px;color: #008000">今开：<strong class="cGreen">2759.94</strong><br/>昨收：<strong
                                class="cGreen">2761.22</strong></td>
                        <td style="width:145px;color: #008000">最高：<strong class="cGreen">2794.01</strong><br/>最低：<strong
                                class="cGreen">2744.98</strong></td>
                        <td style="width:155px;color: #008000">成交量：<strong
                                class="cGreen">29865万手</strong><br/>成交额：<strong
                                class="cGreen">2530.33亿</strong></td>
                    </tr>
                    <tr>
                        <td class="price" style="width:200px;padding-left:0px;"><span class="price_arrow down"><strong
                                class="cGreen">2941.52</strong></span><em class="cGreen">-19.77</em><br> <em
                                class="cGreen">-0.67%</em></td>
                        <td colspan="2">近60天走势及高低点：<br/><br/>
                            <span class="sparkslimShort"></span>

                        </td>
                        <td colspan="2">近1年价格区间及当前位置：<br/><br/><span class="irs" style="width:95%;margin:0 auto;"><span
                                class="irs"><span class="irs-line" tabindex="-1"><span
                                class="irs-line-left"></span><span class="irs-line-mid"></span><span
                                class="irs-line-right"></span></span><span class="irs-min">2079.11</span> <span
                                class="irs-max">2809.06</span> <span class="irs-from" style="left: 42%;">92.16%</span> </span><span
                                class="irs-slider" style="left: 88.16%;"></span> </span></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id="jyzjl_1" style="width:100%;height:500px;"></div>
            <a style="color: red">注：横轴为行业分类，纵轴为该分类下当日参与交易股票的总资金量(亿)。</a>
            <div id="jyzjl_5" style="width:100%;height:500px;margin-top: 50px"></div>
            <a style="color: red">注：横轴为行业分类，纵轴为该分类下近5日参与交易股票的总资金量(亿)。</a>
            <div id="jyzjl_20" style="width:100%;height:500px;margin-top: 50px"></div>
            <a style="color: red">注：横轴为行业分类，纵轴为该分类下近20日参与交易股票的总资金量(亿)。</a>
            <div style="width:100%;margin-top: 50px">
                <table class="table mb-0">
                    <thead class="thead-light">
                    <tr>
                        <th>#</th>
                        <th>行业</th>
                        <th>近30天交易资金走势（亿）</th>
                        <th>近30天交易资金变化率</th>
                        <th>当日变化率</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td>银行</td>
                        <td id="zs_1"></td>
                        <td id="bhl_1"></td>
                        <td id="drbhl_1" style="color: red">81%</td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>建筑材料</td>
                        <td id="zs_2"></td>
                        <td id="bhl_2"></td>
                        <td id="drbhl_2" style="color: red">35%</td>
                    </tr>
                    <tr>
                        <th scope="row">3</th>
                        <td>轻工制造</td>
                        <td id="zs_3"></td>
                        <td id="bhl_3"></td>
                        <td id="drbhl_3" style="color: red">33%</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id='test' style="height:30px;width:100%"></div>

        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script src="{{ url_for('static',filename='libs/sparkline/jquery.sparkline.min.js') }}"></script>
    <script src="{{ url_for('static',filename='libs/echarts/echarts.js') }}"></script>
    <script type="text/javascript">
        global_date = ''
        global_code = {{ code }}
        {#    用设置导航栏active#}
        function active(code) {
                    console.log(code)
                    $('#' + code).removeClass("nav-item")
                    $('#' + code).addClass("nav-item active")

                    {#            li.setAttribute("class", "nav-item active");#}
                }
        {#用于填充左侧时间列表#}
        function creat_date_tab(stime, etime) {
            //初始化日期列表，数组
            {#            var diffdate = new Array();#}
            var i = 0;
            $("#date_tab").append("<a class=\"nav-link active show mb-2\" data-toggle=\"pill\"href=\"#v-pills-home\" onclick=\"change_date('" + stime + "')\" >" + stime + "</a>")
            //开始日期小于等于结束日期,并循环
            while (stime <= etime) {

                {#                diffdate[i] = stime;#}
                //获取开始日期时间戳
                var stime_ts = new Date(stime).getTime();
                {#                console.log('当前日期：' + stime + '当前时间戳：' + stime_ts);#}

                //增加一天时间戳后的日期
                var next_date = stime_ts + (24 * 60 * 60 * 1000);

                //拼接年月日，这里的月份会返回（0-11），所以要+1
                var next_dates_y = new Date(next_date).getFullYear() + '/';
                var next_dates_m = (new Date(next_date).getMonth() + 1 < 10) ? '0' + (new Date(next_date).getMonth() + 1) + '/' : (new Date(next_date).getMonth() + 1) + '/';
                var next_dates_d = (new Date(next_date).getDate() < 10) ? '0' + new Date(next_date).getDate() : new Date(next_date).getDate();

                stime = next_dates_y + next_dates_m + next_dates_d;
                $("#date_tab").append("<a class=\"nav-link  show mb-2\" data-toggle=\"pill\"href=\"#v-pills-home\" onclick=\"change_date('" + stime + "')\" >" + stime + "</a>")
                //增加数组key
                i++;

            }

            {#            console.log(diffdate);#}
        }
        {#时间列表点击事件#}
        function change_date(date) {
            console.log(date)
            global_date = date
        }
        creat_date_tab("2018/11/01", "2018/11/30");
        active(global_code)
        {#        $(document).ready(function () {#}
        $(".sparkslimShort").sparkline([2651.51, 2645.43, 2579.48, 2575.81, 2574.68, 2601.74, 2567.44, 2588.19, 2654.80, 2665.96, 2649.81, 2605.18, 2605.89, 2584.58, 2594.09, 2602.15, 2634.05, 2593.74, 2597.97, 2576.65, 2549.56, 2536.27, 2516.25, 2527.01, 2504.82, 2498.29, 2483.09, 2493.90, 2465.29, 2464.36, 2514.87, 2533.09, 2526.46, 2544.34, 2535.10, 2553.83, 2535.77, 2570.34, 2570.42, 2559.64, 2596.01, 2610.51, 2579.70, 2581.00, 2591.69, 2601.72, 2596.98, 2594.25, 2575.58, 2584.57, 2618.23, 2653.90, 2671.89, 2721.07, 2719.70, 2682.39, 2754.36, 2755.65, 2761.22, 2751.80], {
            type: "line",
            width: "90%",
            height: "40",
            spotColor: false,
            spotRadius: 3,
            lineColor: "#adadad",
            fillColor: "#f4fce1"
        });
        {#                            });#}
        var myChart_1 = echarts.init(document.getElementById('jyzjl_1'));
        myChart_1.hideLoading();
        option_1 = {
            title: {
                text: '今日不同行业分类下的交易资金量'
            },
            xAxis: {
                type: 'category',
                data: ['电子', '化工', '医药生物', '通讯', '机械设备', '国防军工', '休闲服务'],
                axisLabel: {
                    interval: 0,
                    rotate: 20,
                    textStyle: {
                        color: function (value, index) {
                            if (index < 2) {
                                return 'red';
                            } else if (index > 4) {
                                return 'green';
                            } else {
                                return 'black'
                            }
                        }
                    }
                }
            },
            yAxis: {
                type: 'value'
            }
            ,
            series: [{
                data: [120, 200, 150, 80, 70, 110, 90],
                type: 'bar',
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                    },
                },
                markLine: {
                    data: [
                        {type: 'average', name: '平均值'}
                    ],
                },
            }],
        };
        myChart_1.setOption(option_1);
        var myChart_5 = echarts.init(document.getElementById('jyzjl_5'));
        myChart_5.hideLoading();
        option_5 = {
            title: {
                text: '今日不同行业分类下的交易资金量'
            },
            xAxis: {
                type: 'category',
                data: ['电子', '化工', '医药生物', '通讯', '机械设备', '国防军工', '休闲服务'],
                axisLabel: {
                    interval: 0,
                    rotate: 20,
                    textStyle: {
                        color: function (value, index) {
                            if (index < 2) {
                                return 'red';
                            } else if (index > 4) {
                                return 'green';
                            } else {
                                return 'black'
                            }
                        }
                    }
                }
            },
            yAxis: {
                type: 'value'
            }
            ,
            series: [{
                data: [120, 200, 150, 80, 70, 110, 90],
                type: 'bar',
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                    },
                },
                markLine: {
                    data: [
                        {type: 'average', name: '平均值'}
                    ],
                },
            }],
        };
        myChart_5.setOption(option_1);
        var myChart_20 = echarts.init(document.getElementById('jyzjl_20'));
        myChart_20.hideLoading();
        option_20 = {
            title: {
                text: '今日不同行业分类下的交易资金量'
            },
            xAxis: {
                type: 'category',
                data: ['电子', '化工', '医药生物', '通讯', '机械设备', '国防军工', '休闲服务'],
                axisLabel: {
                    interval: 0,
                    rotate: 20,
                    textStyle: {
                        color: function (value, index) {
                            if (index < 2) {
                                return 'red';
                            } else if (index > 4) {
                                return 'green';
                            } else {
                                return 'black'
                            }
                        }
                    }
                }
            },
            yAxis: {
                type: 'value'
            }
            ,
            series: [{
                data: [120, 200, 150, 80, 70, 110, 90],
                type: 'bar',
                label: {
                    normal: {
                        show: true,
                        position: 'top',
                    },
                },
                markLine: {
                    data: [
                        {type: 'average', name: '平均值'}
                    ],
                },
            }],
        };
        myChart_20.setOption(option_20);
        var myChart_zs_1 = echarts.init(document.getElementById('zs_1'));
        myChart_zs_1.hideLoading();
        option_zs_1 = {
            grid: {
                x: 0,
                y: 0,
                //x2: 0,
                y2: 0,

            },
            xAxis: {
                type: 'category',
                data: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
                show: false
            },
            yAxis: {
                type: 'value',
                show: false,
                min: function (value) {
                    return value.min - 50;
                },
                max: function (value) {
                    return value.max + 50;
                }
            },
            series: [{
                data: [420, 432, 401, 434, 400, 450, 410, 432, 420, 455],
                type: 'line',
                smooth: false,
                areaStyle: {},
            }]
        };
        myChart_zs_1.setOption(option_zs_1);
        window.onresize = function () {
            myChart_zs_1.resize();
        }
    </script>
{% endblock %}
