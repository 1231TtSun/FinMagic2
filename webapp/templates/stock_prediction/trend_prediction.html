{% extends "stock_prediction/stock_prediction_base.html" %}
{% block page_container %}
    <div class="row">
        <div class="col-2 pl-5">
            <div class="row">
                <div class="nav flex-column nav-pills nav-pills-tab" id="v-pills-tab" role="tablist"
                     aria-orientation="vertical">
                    {% for day in date_list %}
                        {% if day==date %}
                            <a class="nav-link active mb-2"
                               href="{{ url_for('stock_prediction.trend_prediction',code=stock.ts_code,date=day) }}">
                                {{ "%s/%s/%s"|format(day[0:4],day[4:6],day[6:8]) }}
                            </a>
                        {% else %}
                            <a class="nav-link mb-2"
                               href="{{ url_for('stock_prediction.trend_prediction',code=stock.ts_code,date=day) }}">
                                {{ "%s/%s/%s"|format(day[0:4],day[4:6],day[6:8]) }}
                            </a>
                        {% endif %}
                    {% endfor %}
                </div>
            </div> <!-- end row-->
        </div>
        <div class="col-10">
            <div class="card">
                <div class="card-header" style="font-size: 20px;font-weight: bold">
                    基本行情({{ "%s/%s/%s"|format(date[0:4],date[4:6],date[6:8]) }})
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-2 text-center" style="font-size: 30px;font-weight:bold;color:#00A2C7">
                            <p>{{ stock.name }}<br/>{{ stock.symbol }}</p>
                        </div>
                        <div class="col-10" id="today_data">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" style="font-size: 20px;font-weight: bold">
                    B/S买卖点
                    <button class="btn btn-info">详解</button>
                    <button class="btn btn-info">排序</button>
                </div>
                <div class="card-body">
                    <span style="color: red;font-size: 20px">预测一：积极方式</span>
                    <div id="trade_point_aggressive" style="width: 100%;height: 600px"></div>
                    <div class="pl-3 mb-3" style="font-size: 20px"><i class="mdi mdi-bookmark"
                                                                      style="color: orangered;font-size: 25px"></i>
                        明日操作提示：<span id="aggressive_requirement"></span>。
                    </div>
                    <div class="col-12 mb-2" style="border: solid lightgrey 1px"></div>
                    <span style="color: red;font-size: 20px">预测二：稳健方式</span>
                    <div id="trade_point_steady" style="width: 100%;height: 600px"></div>
                    <div class="pl-3 mb-3" style="font-size: 20px"><i class="mdi mdi-bookmark"
                                                                      style="color: orangered;font-size: 25px"></i>明日操作提示：<span
                            id="steady_requirement"></span>。
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" style="font-size: 20px;font-weight: bold">
                    近期涨跌预测
                    <button class="btn btn-info">详解</button>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-4 text-center">
                            <div style="width: 100%;height: 180px" id="first_pie"></div>
                        </div>
                        <div class="col-4 text-center">
                            <div style="width: 100%;height: 180px" id="second_pie"></div>
                        </div>
                        <div class="col-4 text-center">
                            <div style="width: 100%;height: 180px" id="third_pie"></div>
                        </div>
                    </div>
                    <div class="row text-center" style="color:#00B597;font-size: 20px">
                        <div class="col-4">
                            <p><span id="first_change"><i class="dripicons-arrow-down"></i></span></p>
                            <p>1日</p>
                        </div>
                        <div class="col-4">
                            <p><span id="second_change"><i class="dripicons-arrow-down"></i></span></p>
                            <p>2日</p>
                        </div>
                        <div class="col-4">
                            <p><span id="third_change"><i class="dripicons-arrow-down"></i></span></p>
                            <p>3日</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-9 text-center" id="trend_forecast_vote">
                        </div>
                        <div class="col-3 text-center" id="trend_forecast_change">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" style="font-size: 20px;font-weight: bold">
                    短期相似走势
                    <button class="btn btn-info">详解</button>
                    <button class="btn btn-info">排序</button>
                    <span class="btn btn-danger" style="float:right;" id="similarity_1_trend_description"></span>
                </div>
                <div class="card-body">
                    <span style="color: red;font-size: 20px">预测1：可信度高</span>
                    <div id="similarity_1" style="width: 100%;height: 600px"></div>
                    <div id="similarity_match_1" style="width: 100%;height: 600px"></div>
                    <div class="row col-12">
                        <div class="col-4">
                            相似度：<span id="similarity_1_distance"></span>
                        </div>
                        <div class="col-8">
                            <span id="similarity_1_sparkline"></span>
                        </div>
                    </div>
                    <div class="row col-12">
                        <ul class="nav nav-tabs tabs-bordered">
                            <li class="nav-item">
                                <a href="#similarity_1_1" data-toggle="tab" aria-expanded="false"
                                   class="nav-link active">
                                    Day.1-5
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_1_2" data-toggle="tab" aria-expanded="true" class="nav-link">
                                    Day.6-10
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_1_3" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.11-15
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_1_4" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.16-20
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_1_5" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.21-25
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_1_6" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.26-30
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content" style="width: 100%">
                            <div class="tab-pane show active" id="similarity_1_1">
                            </div>
                            <div class="tab-pane" id="similarity_1_2">
                            </div>
                            <div class="tab-pane" id="similarity_1_3">
                            </div>
                            <div class="tab-pane" id="similarity_1_4">
                            </div>
                            <div class="tab-pane" id="similarity_1_5">
                            </div>
                            <div class="tab-pane" id="similarity_1_6">
                            </div>
                        </div>
                    </div>
                    <span style="color: orange;font-size: 20px">预测2：可信度中</span>
                    <div id="similarity_2" style="width: 100%;height: 600px"></div>
                    <div id="similarity_match_2" style="width: 100%;height: 600px"></div>
                    <div class="row col-12">
                        <div class="col-4">
                            相似度：<span id="similarity_2_distance"></span>
                        </div>
                        <div class="col-8">
                            <span id="similarity_2_sparkline"></span>
                        </div>
                    </div>
                    <div class="row col-12">
                        <ul class="nav nav-tabs tabs-bordered">
                            <li class="nav-item">
                                <a href="#similarity_2_1" data-toggle="tab" aria-expanded="false"
                                   class="nav-link active">
                                    Day.1-5
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_2_2" data-toggle="tab" aria-expanded="true" class="nav-link">
                                    Day.6-10
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_2_3" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.11-15
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_2_4" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.16-20
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_2_5" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.21-25
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_2_6" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.26-30
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content" style="width: 100%">
                            <div class="tab-pane show active" id="similarity_2_1">
                            </div>
                            <div class="tab-pane" id="similarity_2_2">
                            </div>
                            <div class="tab-pane" id="similarity_2_3">
                            </div>
                            <div class="tab-pane" id="similarity_2_4">
                            </div>
                            <div class="tab-pane" id="similarity_2_5">
                            </div>
                            <div class="tab-pane" id="similarity_2_6">
                            </div>
                        </div>
                    </div>
                    <span style="color: yellowgreen;font-size: 20px">预测3：可信度一般</span>
                    <div id="similarity_3" style="width: 100%;height: 600px"></div>
                    <div id="similarity_match_3" style="width: 100%;height: 600px"></div>
                    <div class="row col-12">
                        <div class="col-4">
                            相似度：<span id="similarity_3_distance"></span>
                        </div>
                        <div class="col-8">
                            <span id="similarity_3_sparkline"></span>
                        </div>
                    </div>
                    <div class="row col-12">
                        <ul class="nav nav-tabs tabs-bordered">
                            <li class="nav-item">
                                <a href="#similarity_3_1" data-toggle="tab" aria-expanded="false"
                                   class="nav-link active">
                                    Day.1-5
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_3_2" data-toggle="tab" aria-expanded="true" class="nav-link">
                                    Day.6-10
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_3_3" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.11-15
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_3_4" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.16-20
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_3_5" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.21-25
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_3_6" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.26-30
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content" style="width: 100%">
                            <div class="tab-pane show active" id="similarity_3_1">
                            </div>
                            <div class="tab-pane" id="similarity_3_2">
                            </div>
                            <div class="tab-pane" id="similarity_3_3">
                            </div>
                            <div class="tab-pane" id="similarity_3_4">
                            </div>
                            <div class="tab-pane" id="similarity_3_5">
                            </div>
                            <div class="tab-pane" id="similarity_3_6">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" style="font-size: 20px;font-weight: bold">
                    短期相关走势
                    <button class="btn btn-info">详解</button>
                    <button class="btn btn-info">排序</button>
                    <span class="btn btn-danger" style="float:right;" id="correlation_1_trend_description"></span>
                </div>
                <div class="card-body">
                    <span style="color: red;font-size: 20px">预测1：可信度高</span>
                    <div id="correlation_1" style="width: 100%;height: 600px"></div>
                    <div id="correlation_match_1" style="width: 100%;height: 600px"></div>
                    <div class="row col-12">
                        <div class="col-4">
                            相关系数：<span id="correlation_1_r"></span>
                        </div>
                        <div class="col-8">
                            <span id="correlation_1_sparkline"></span>
                        </div>
                    </div>
                    <div class="row col-12">
                        <ul class="nav nav-tabs tabs-bordered">
                            <li class="nav-item">
                                <a href="#correlation_1_1" data-toggle="tab" aria-expanded="false"
                                   class="nav-link active">
                                    Day.1-5
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_1_2" data-toggle="tab" aria-expanded="true" class="nav-link">
                                    Day.6-10
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_1_3" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.11-15
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_1_4" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.16-20
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_1_5" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.21-25
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_1_6" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.26-30
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content" style="width: 100%">
                            <div class="tab-pane show active" id="correlation_1_1">
                            </div>
                            <div class="tab-pane" id="correlation_1_2">
                            </div>
                            <div class="tab-pane" id="correlation_1_3">
                            </div>
                            <div class="tab-pane" id="correlation_1_4">
                            </div>
                            <div class="tab-pane" id="correlation_1_5">
                            </div>
                            <div class="tab-pane" id="correlation_1_6">
                            </div>
                        </div>
                    </div>
                    <span style="color: orange;font-size: 20px">预测2：可信度中</span>
                    <div id="correlation_2" style="width: 100%;height: 600px"></div>
                    <div id="correlation_match_2" style="width: 100%;height: 600px"></div>
                    <div class="row col-12">
                        <div class="col-4">
                            相关系数：<span id="correlation_2_r"></span>
                        </div>
                        <div class="col-8">
                            <span id="correlation_2_sparkline"></span>
                        </div>
                    </div>
                    <div class="row col-12">
                        <ul class="nav nav-tabs tabs-bordered">
                            <li class="nav-item">
                                <a href="#correlation_2_1" data-toggle="tab" aria-expanded="false"
                                   class="nav-link active">
                                    Day.1-5
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_2_2" data-toggle="tab" aria-expanded="true" class="nav-link">
                                    Day.6-10
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_2_3" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.11-15
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_2_4" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.16-20
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_2_5" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.21-25
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_2_6" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.26-30
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content" style="width: 100%">
                            <div class="tab-pane show active" id="correlation_2_1">
                            </div>
                            <div class="tab-pane" id="correlation_2_2">
                            </div>
                            <div class="tab-pane" id="correlation_2_3">
                            </div>
                            <div class="tab-pane" id="correlation_2_4">
                            </div>
                            <div class="tab-pane" id="correlation_2_5">
                            </div>
                            <div class="tab-pane" id="correlation_2_6">
                            </div>
                        </div>
                    </div>
                    <span style="color: yellowgreen;font-size: 20px">预测3：可信度一般</span>
                    <div id="correlation_3" style="width: 100%;height: 600px"></div>
                    <div id="correlation_match_3" style="width: 100%;height: 600px"></div>
                    <div class="row col-12">
                        <div class="col-4">
                            相关系数：<span id="correlation_3_r"></span>
                        </div>
                        <div class="col-8">
                            <span id="correlation_3_sparkline"></span>
                        </div>
                    </div>
                    <div class="row col-12">
                        <ul class="nav nav-tabs tabs-bordered">
                            <li class="nav-item">
                                <a href="#correlation_3_1" data-toggle="tab" aria-expanded="false"
                                   class="nav-link active">
                                    Day.1-5
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_3_2" data-toggle="tab" aria-expanded="true" class="nav-link">
                                    Day.6-10
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_3_3" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.11-15
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_3_4" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.16-20
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_3_5" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.21-25
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#correlation_3_6" data-toggle="tab" aria-expanded="false" class="nav-link">
                                    Day.26-30
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content" style="width: 100%">
                            <div class="tab-pane show active" id="correlation_3_1">
                            </div>
                            <div class="tab-pane" id="correlation_3_2">
                            </div>
                            <div class="tab-pane" id="correlation_3_3">
                            </div>
                            <div class="tab-pane" id="correlation_3_4">
                            </div>
                            <div class="tab-pane" id="correlation_3_5">
                            </div>
                            <div class="tab-pane" id="correlation_3_6">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" style="font-size: 20px;font-weight: bold">
                    自身历史重现
                    <button class="btn btn-info">详解</button>
                    <button class="btn btn-info">排序</button>
                </div>
                <div class="card-body">
                    <div id="similarity_history" style="width: 100%;height: 600px"></div>
                    <div class="row col-12">
                        <div class="col-4">
                            匹配日期：<span id="similarity_history_date"></span>
                        </div>
                        <div class="col-8">
                            <span id="similarity_history_sparkline"></span>
                        </div>
                    </div>
                    <div class="row col-12">
                        <ul class="nav nav-tabs tabs-bordered">
                            <li class="nav-item">
                                <a href="#similarity_history_1" data-toggle="tab" aria-expanded="false"
                                   class="nav-link active">
                                    Day.1-5
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_history_2" data-toggle="tab" aria-expanded="true" class="nav-link">
                                    Day.6-10
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_history_3" data-toggle="tab" aria-expanded="false"
                                   class="nav-link">
                                    Day.11-15
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_history_4" data-toggle="tab" aria-expanded="false"
                                   class="nav-link">
                                    Day.16-20
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_history_5" data-toggle="tab" aria-expanded="false"
                                   class="nav-link">
                                    Day.21-25
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="#similarity_history_6" data-toggle="tab" aria-expanded="false"
                                   class="nav-link">
                                    Day.26-30
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content" style="width: 100%">
                            <div class="tab-pane show active" id="similarity_history_1">
                            </div>
                            <div class="tab-pane" id="similarity_history_2">
                            </div>
                            <div class="tab-pane" id="similarity_history_3">
                            </div>
                            <div class="tab-pane" id="similarity_history_4">
                            </div>
                            <div class="tab-pane" id="similarity_history_5">
                            </div>
                            <div class="tab-pane" id="similarity_history_6">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header" style="font-size: 20px;font-weight: bold">
                    长期强弱预测
                    <button class="btn btn-info">详解</button>
                    <button class="btn btn-info">排序</button>
                </div>
                <div class="card-body">
                    <span style="color: red;font-size: 20px">小幅度方式：</span>
                    <div class="row pl-3 pr-3 mt-3 mb-3" id="s_state_transition_process_bar">
                    </div>
                    <div class="row" id="s_state_transition_table">
                    </div>
                    <div class="row pl-5 pr-5">
                        <span id="s_state_transition_chart" style="width: 100%;height: 80px"></span>
                        <span class="text-center" style="width: 100%">长期强弱走势图（近60日）</span>
                    </div>
                    <span style="color: red;font-size: 20px">大幅度方式：</span>
                    <div class="row pl-3 pr-3 mt-3 mb-3" id="l_state_transition_process_bar">

                    </div>
                    <div class="row" id="l_state_transition_table">
                    </div>
                    <div class="row pl-5 pr-5">
                        <span id="l_state_transition_chart" style="width: 100%;height: 80px"></span>
                        <span class="text-center" style="width: 100%">长期强弱走势图（近60日）</span>
                    </div>
                    <div class="row">
                        <div style="width: 100%;height: 800px;" id="state_transition_chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block styles %}
    <style>
        .progress {
            box-shadow: none;
            border-radius: 10px;
            background-color: #f2f2f2;
            height: 60px;
            margin-bottom: 20px;
            display: block;
            width: 95%;
            padding: 5px;
            margin: 0 auto
        }

        .progress .progress-bar-green {
            background-color: #1ab394;
            border-radius: 10px 0 0 10px
        }

        .progress .progress-bar-gray {
            background-color: #b4b4b4
        }

        .progress .progress-bar-red {
            background-color: #cd5e63;
            border-radius: 0 10px 10px 0
        }

        .progress-bar {
            float: left;
            width: 0;
            height: 100%;
            line-height: 60px;
            font-size: 14px;
            color: #fff;
            text-align: center;
            background-color: #b4b4b4
        }
    </style>
{% endblock %}
{% block page_scripts %}
    <script src="{{ url_for('static',filename='libs/sparkline/jquery.sparkline.min.js') }}"></script>
    <script src="{{ url_for('static',filename='libs/echarts/echarts.js') }}"></script>
    <script>
        $.ajax({
            type: "GET",
            url: "{{ url_for('stock_prediction.api_trend_prediction') }}",
            data: {code: stock, date: '20181101'},
            dataType: "json",
            success: function (r) {
                show_today_data(r.today_bar_data, r.today_basic_data)
                draw_trade_point_chart(r.trade_point_data)
                draw_trend_forecast(r.trend_forecast_data)
                draw_similarity_short_term(r.similarity_short_term_data)
                draw_correlation_short_term(r.correlation_short_term_data)
                draw_similarity_history(r.similarity_history_data)
                draw_state_transition(r.state_transition_data)
            }
        });

        function show_today_data(bar, basic) {
            var fontcolor = ''
            if (bar.change > 0) {
                fontcolor = 'red'
            } else if (bar.change < 0) {
                fontcolor = 'green'
            } else {
                fontcolor = '#00A2C7'
            }
            var html = "<table style=\"width: 100%;height: 100%\">\n" +
                "                                <tbody>\n" +
                "                                <tr>";
            html += "<td>涨幅：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + bar.pct_chg + "</span></td>"
            html += "<td>今开：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + bar.open + "</span></td>"
            html += "<td>换手率：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + basic.turnover_rate + "</span></td>"
            html += "<td>成交量：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + bar.vol + "</span></td></tr><tr>"
            html += "<td>今收：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + bar.close + "</span></td>"
            html += "<td>最高：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + bar.high + "</span></td>"
            html += "<td>市盈率：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + basic.pe + "</span></td>"
            html += "<td>成交额：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + bar.amount + "</span></td></tr><tr>"
            html += "<td>昨收：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + bar.pre_close + "</span></td>"
            html += "<td>最低：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + bar.low + "</span></td>"
            html += "<td>市净率：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + basic.pb + "</span></td>"
            html += "<td>流通值：<span style=\"color: " + fontcolor + ";font-weight: bold\">" + basic.circ_mv + "</span></td>"
            html += "</tr>\n" +
                "                                </tbody>\n" +
                "                            </table>"
            $("#today_data").html(html)
        }

        function draw_trade_point_chart(rawData) {
            function splitData(rawData) {
                var categoryData = [];
                var values = [];
                var volumes = [];
                for (var i = 0; i < rawData.length; i++) {
                    categoryData.push(rawData[i].splice(0, 1)[0]);
                    values.push(rawData[i])
                    volumes.push([i, rawData[i][4], rawData[i][1] > rawData[i][0] ? 1 : -1]);
                }
                return {
                    categoryData: categoryData,
                    values: values,
                    volumes: volumes
                };
            }

            var upColor = '#ec0000';
            var downColor = '#00da3c';
            var bs_aggressive = echarts.init(document.getElementById('trade_point_aggressive'));
            var bs_steady = echarts.init(document.getElementById('trade_point_steady'));
            var data = splitData(rawData.line_data);

            function calculateMA(dayCount) {
                var result = [];
                for (var i = 0, len = data.values.length; i < len; i++) {
                    if (i < dayCount) {
                        result.push('-');
                        continue;
                    }
                    var sum = 0;
                    for (var j = 0; j < dayCount; j++) {
                        sum += data.values[i - j][1];
                    }
                    result.push((sum / dayCount).toFixed(2));
                }
                return result;
            }

            var option_aggressive = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }, {
                    show: false,
                    seriesIndex: 4,
                    dimension: 2,
                    pieces: [{
                        value: '买点',
                        color: upColor
                    }, {
                        value: '卖点',
                        color: downColor
                    }]

                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        type: 'scatter',
                        symbol: 'pin',
                        symbolSize: 40,
                        data: rawData.aggressive,
                        label: {
                            show: true,
                            formatter: '{@[2]}',
                            color: 'black'
                        }
                    }
                ]
            };
            var option_steady = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }, {
                    show: false,
                    seriesIndex: 4,
                    dimension: 2,
                    pieces: [{
                        value: '买点',
                        color: upColor
                    }, {
                        value: '卖点',
                        color: downColor
                    }]

                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        type: 'scatter',
                        symbol: 'pin',
                        symbolSize: 40,
                        data: rawData.steady,
                        label: {
                            show: true,
                            formatter: '{@[2]}',
                            color: 'black'
                        }
                    }
                ]
            };
            bs_aggressive.setOption(option_aggressive)
            bs_steady.setOption(option_steady)
            $("#aggressive_requirement").html(rawData.aggressive_requirement)
            $("#steady_requirement").html(rawData.steady_requirement)
        }

        function draw_trend_forecast(data) {
            $("#first_pie").sparkline(data.first_vote, {
                type: "pie",
                width: "150px",
                height: "150px",
                sliceColors: ["#1ab394", "#b4b4b4", "#cd5e63"]
            });
            $("#second_pie").sparkline(data.second_vote, {
                type: "pie",
                width: "150px",
                height: "150px",
                sliceColors: ["#1ab394", "#b4b4b4", "#cd5e63"]
            });
            $("#third_pie").sparkline(data.third_vote, {
                type: "pie",
                width: "150px",
                height: "150px",
                sliceColors: ["#1ab394", "#b4b4b4", "#cd5e63"]
            });
            if (data.first_change >= 0) {
                var html = "<i class=\"dripicons-arrow-up\"></i>" + data.first_change + "%";
                $("#first_change").html(html).css('color', 'red');
            } else {
                var html = "<i class=\"dripicons-arrow-down\"></i>" + data.first_change + "%";
                $("#first_change").html(html).css('color', 'green');
            }
            if (data.second_change >= 0) {
                var html = "<i class=\"dripicons-arrow-up\"></i>" + data.second_change + "%";
                $("#second_change").html(html).css('color', 'red');
            } else {
                var html = "<i class=\"dripicons-arrow-down\"></i>" + data.second_change + "%";
                $("#second_change").html(html).css('color', 'green');
            }
            if (data.third_change >= 0) {
                var html = "<i class=\"dripicons-arrow-up\"></i>" + data.third_change + "%";
                $("#third_change").html(html).css('color', 'red');
            } else {
                var html = "<i class=\"dripicons-arrow-down\"></i>" + data.third_change + "%";
                $("#third_change").html(html).css('color', 'green');
            }
            var html_left = "<table class=\"table mb-0\">\n" +
                "                                <thead>\n" +
                "                                <tr>\n" +
                "                                    <th>预测周期</th>\n" +
                "                                    <th>跌的票数</th>\n" +
                "                                    <th>平的票数</th>\n" +
                "                                    <th>涨的票数</th>\n" +
                "                                </tr>\n" +
                "                                </thead>\n" +
                "                                <tbody>\n" +
                "                                <tr>\n" +
                "                                    <th scope=\"row\">1日</th>\n" +
                "                                    <td style=\"color: #66ccff\">" + data.first_vote[0] + "</td>\n" +
                "                                    <td>" + data.first_vote[1] + "</td>\n" +
                "                                    <td style=\"color: #E0575C\">" + data.first_vote[2] + "</td>\n" +
                "                                </tr>\n" +
                "                                <tr>\n" +
                "                                    <th scope=\"row\">2日</th>\n" +
                "                                    <td style=\"color: #66ccff\">" + data.second_vote[0] + "</td>\n" +
                "                                    <td>" + data.second_vote[1] + "</td>\n" +
                "                                    <td style=\"color: #E0575C\">" + data.second_vote[2] + "</td>\n" +
                "                                </tr>\n" +
                "                                <tr>\n" +
                "                                    <th scope=\"row\">3日</th>\n" +
                "                                    <td style=\"color: #66ccff\">" + data.third_vote[0] + "</td>\n" +
                "                                    <td>" + data.third_vote[1] + "</td>\n" +
                "                                    <td style=\"color: #E0575C\">" + data.third_vote[2] + "</td>\n" +
                "                                </tr>\n" +
                "                                </tbody>\n" +
                "                            </table>"
            var html_right = "<table class=\"table mb-0\" style=\"color:#66ccff;border: solid #66ccff 3px\">\n" +
                "                                <thead>\n" +
                "                                <tr>\n" +
                "                                    <th style=\"font-size: 25px\">可能涨跌幅</th>\n" +
                "                                </tr>\n" +
                "                                </thead>\n" +
                "                                <tbody>\n" +
                "                                <tr>\n" +
                "                                    <th scope=\"row\">" + data.first_change + "%</th>\n" +
                "                                </tr>\n" +
                "                                <tr>\n" +
                "                                    <th scope=\"row\">" + data.second_change + "%</th>\n" +
                "                                </tr>\n" +
                "                                <tr>\n" +
                "                                    <th scope=\"row\">" + data.third_change + "%</th>\n" +
                "                                </tr>\n" +
                "                                </tbody>\n" +
                "                            </table>"
            $("#trend_forecast_vote").html(html_left)
            $("#trend_forecast_change").html(html_right)
        }

        function draw_similarity_short_term(rawData) {
            var upColor = '#ec0000';
            var downColor = '#00da3c';

            function format_similarity_data(data) {
                for (i = 0; i < 30; i++) {
                    data[i + 60][0] = (i + 1).toString()
                }
            }

            format_similarity_data(rawData.similarity_1_data)
            format_similarity_data(rawData.similarity_2_data)
            format_similarity_data(rawData.similarity_3_data)
            var similarity_1 = echarts.init(document.getElementById('similarity_1'));
            var similarity_2 = echarts.init(document.getElementById('similarity_2'));
            var similarity_3 = echarts.init(document.getElementById('similarity_3'));
            var similarity_match_1 = echarts.init(document.getElementById('similarity_match_1'));
            var similarity_match_2 = echarts.init(document.getElementById('similarity_match_2'));
            var similarity_match_3 = echarts.init(document.getElementById('similarity_match_3'));

            function splitData(rawData) {
                var categoryData = [];
                var values = [];
                var volumes = [];
                for (var i = 0; i < rawData.length; i++) {
                    categoryData.push(rawData[i].splice(0, 1)[0]);
                    values.push(rawData[i])
                    volumes.push([i, rawData[i][4], rawData[i][1] > rawData[i][0] ? 1 : -1]);
                }
                return {
                    categoryData: categoryData,
                    values: values,
                    volumes: volumes
                };
            }

            var similarity_1_data = splitData(rawData.similarity_1_data);
            var similarity_2_data = splitData(rawData.similarity_2_data);
            var similarity_3_data = splitData(rawData.similarity_3_data);
            var similarity_match_1_data = splitData(rawData.similarity_match_1_data);
            var similarity_match_2_data = splitData(rawData.similarity_match_2_data);
            var similarity_match_3_data = splitData(rawData.similarity_match_3_data);

            function calculateMA(dayCount, data) {
                var result = [];
                for (var i = 0, len = data.values.length; i < len; i++) {
                    if (i < dayCount) {
                        result.push('-');
                        continue;
                    }
                    var sum = 0;
                    for (var j = 0; j < dayCount; j++) {
                        sum += data.values[i - j][1];
                    }
                    result.push((sum / dayCount).toFixed(2));
                }
                return result;
            };
            $("#similarity_1_trend_description").html(rawData.trend_description)
            var similarity_1_option = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: similarity_1_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: similarity_1_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: similarity_1_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: similarity_1_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.mark_line[0]
                            }, {
                                xAxis: rawData.mark_line[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, similarity_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, similarity_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, similarity_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            var similarity_match_1_option = {
                title: {
                    text: rawData.similarity_stock[0].name + "(" + rawData.similarity_stock[0].code + ")",
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: similarity_match_1_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: similarity_match_1_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: similarity_match_1_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: similarity_match_1_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.similarity_match_mark_line_1[0]
                            }, {
                                xAxis: rawData.similarity_match_mark_line_1[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, similarity_match_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, similarity_match_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, similarity_match_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            $("#similarity_1_sparkline").sparkline(rawData.similarity_1_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#5eafcd',
                fillColor: '#f4fce1',
                tooltipFormatFieldlist: [],
                tooltipFormatFieldlistKey: 'field'
            }).sparkline(rawData.sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                chartRangeMin: 9.43,
                chartRangeMax: 13.08,
                lineColor: '#ff0000',
                fillColor: false
            });
            $("#similarity_1_distance").html(rawData.similarity_stock[0].distance);
            for (i = 0; i < 6; i++) {
                var html = "<table class=\"table mb-0\">\n" +
                    "                                    <thead>\n" +
                    "                                    <tr>\n" +
                    "                                        <th>Day.No</th>\n" +
                    "                                        <th>Change</th>\n" +
                    "                                        <th>Open</th>\n" +
                    "                                        <th>High</th>\n" +
                    "                                        <th>Low</th>\n" +
                    "                                        <th>Close</th>\n" +
                    "                                        <th>Volume</th>\n" +
                    "                                    </tr>\n" +
                    "                                    </thead>\n" +
                    "                                    <tbody>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (1 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (2 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 1][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 1][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 1][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 1][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 1][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 1][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (3 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 2][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 2][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 2][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 2][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 2][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 2][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (4 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 3][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 3][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 3][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 3][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 3][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 3][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (5 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 4][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 4][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 4][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 4][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 4][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_1_table_data[5 * i + 4][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    </tbody>\n" +
                    "                                </table>"
                $("#similarity_1_" + (i + 1)).html(html)
            }
            var similarity_2_option = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: similarity_2_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: similarity_2_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: similarity_2_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: similarity_2_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.mark_line[0]
                            }, {
                                xAxis: rawData.mark_line[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, similarity_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, similarity_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, similarity_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            var similarity_match_2_option = {
                title: {
                    text: rawData.similarity_stock[1].name + "(" + rawData.similarity_stock[1].code + ")",
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: similarity_match_2_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: similarity_match_2_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: similarity_match_2_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: similarity_match_2_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.similarity_match_mark_line_2[0]
                            }, {
                                xAxis: rawData.similarity_match_mark_line_2[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, similarity_match_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, similarity_match_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, similarity_match_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            $("#similarity_2_sparkline").sparkline(rawData.similarity_2_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#5eafcd',
                fillColor: '#f4fce1',
                tooltipFormatFieldlist: [],
                tooltipFormatFieldlistKey: 'field'
            }).sparkline(rawData.sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                chartRangeMin: 9.43,
                chartRangeMax: 13.08,
                lineColor: '#ff0000',
                fillColor: false
            });
            $("#similarity_2_distance").html(rawData.similarity_stock[1].distance);
            for (i = 0; i < 6; i++) {
                var html = "<table class=\"table mb-0\">\n" +
                    "                                    <thead>\n" +
                    "                                    <tr>\n" +
                    "                                        <th>Day.No</th>\n" +
                    "                                        <th>Change</th>\n" +
                    "                                        <th>Open</th>\n" +
                    "                                        <th>High</th>\n" +
                    "                                        <th>Low</th>\n" +
                    "                                        <th>Close</th>\n" +
                    "                                        <th>Volume</th>\n" +
                    "                                    </tr>\n" +
                    "                                    </thead>\n" +
                    "                                    <tbody>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (1 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (2 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 1][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 1][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 1][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 1][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 1][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 1][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (3 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 2][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 2][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 2][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 2][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 2][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 2][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (4 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 3][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 3][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 3][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 3][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 3][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 3][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (5 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 4][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 4][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 4][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 4][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 4][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_2_table_data[5 * i + 4][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    </tbody>\n" +
                    "                                </table>"
                $("#similarity_2_" + (i + 1)).html(html)
            }
            var similarity_3_option = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: similarity_3_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: similarity_3_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: similarity_3_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: similarity_3_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.mark_line[0]
                            }, {
                                xAxis: rawData.mark_line[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, similarity_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, similarity_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, similarity_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            var similarity_match_3_option = {
                title: {
                    text: rawData.similarity_stock[2].name + "(" + rawData.similarity_stock[2].code + ")",
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: similarity_match_3_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: similarity_match_3_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: similarity_match_3_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: similarity_match_3_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.similarity_match_mark_line_3[0]
                            }, {
                                xAxis: rawData.similarity_match_mark_line_3[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, similarity_match_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, similarity_match_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, similarity_match_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            $("#similarity_3_sparkline").sparkline(rawData.similarity_3_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#5eafcd',
                fillColor: '#f4fce1',
                tooltipFormatFieldlist: [],
                tooltipFormatFieldlistKey: 'field'
            }).sparkline(rawData.sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                chartRangeMin: 9.43,
                chartRangeMax: 13.08,
                lineColor: '#ff0000',
                fillColor: false
            });
            $("#similarity_3_distance").html(rawData.similarity_stock[2].distance);
            for (i = 0; i < 6; i++) {
                var html = "<table class=\"table mb-0\">\n" +
                    "                                    <thead>\n" +
                    "                                    <tr>\n" +
                    "                                        <th>Day.No</th>\n" +
                    "                                        <th>Change</th>\n" +
                    "                                        <th>Open</th>\n" +
                    "                                        <th>High</th>\n" +
                    "                                        <th>Low</th>\n" +
                    "                                        <th>Close</th>\n" +
                    "                                        <th>Volume</th>\n" +
                    "                                    </tr>\n" +
                    "                                    </thead>\n" +
                    "                                    <tbody>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (1 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (2 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 1][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 1][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 1][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 1][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 1][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 1][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (3 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 2][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 2][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 2][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 2][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 2][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 2][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (4 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 3][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 3][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 3][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 3][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 3][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 3][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (5 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 4][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 4][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 4][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 4][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 4][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_3_table_data[5 * i + 4][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    </tbody>\n" +
                    "                                </table>"
                $("#similarity_3_" + (i + 1)).html(html)
            }
            similarity_1.setOption(similarity_1_option);
            similarity_match_1.setOption(similarity_match_1_option)
            similarity_2.setOption(similarity_2_option);
            similarity_match_2.setOption(similarity_match_2_option)
            similarity_3.setOption(similarity_3_option);
            similarity_match_3.setOption(similarity_match_3_option)


        }

        function draw_correlation_short_term(rawData) {
            var upColor = '#ec0000';
            var downColor = '#00da3c';

            function format_correlation_data(data) {
                for (i = 0; i < 30; i++) {
                    data[i + 60][0] = (i + 1).toString()
                }
            }

            format_correlation_data(rawData.correlation_1_data)
            format_correlation_data(rawData.correlation_2_data)
            format_correlation_data(rawData.correlation_3_data)
            var correlation_1 = echarts.init(document.getElementById('correlation_1'));
            var correlation_2 = echarts.init(document.getElementById('correlation_2'));
            var correlation_3 = echarts.init(document.getElementById('correlation_3'));
            var correlation_match_1 = echarts.init(document.getElementById('correlation_match_1'));
            var correlation_match_2 = echarts.init(document.getElementById('correlation_match_2'));
            var correlation_match_3 = echarts.init(document.getElementById('correlation_match_3'));

            function splitData(rawData) {
                var categoryData = [];
                var values = [];
                var volumes = [];
                for (var i = 0; i < rawData.length; i++) {
                    categoryData.push(rawData[i].splice(0, 1)[0]);
                    values.push(rawData[i])
                    volumes.push([i, rawData[i][4], rawData[i][1] > rawData[i][0] ? 1 : -1]);
                }
                return {
                    categoryData: categoryData,
                    values: values,
                    volumes: volumes
                };
            }

            var correlation_1_data = splitData(rawData.correlation_1_data);
            var correlation_2_data = splitData(rawData.correlation_2_data);
            var correlation_3_data = splitData(rawData.correlation_3_data);
            var correlation_match_1_data = splitData(rawData.correlation_match_1_data);
            var correlation_match_2_data = splitData(rawData.correlation_match_2_data);
            var correlation_match_3_data = splitData(rawData.correlation_match_3_data);

            function calculateMA(dayCount, data) {
                var result = [];
                for (var i = 0, len = data.values.length; i < len; i++) {
                    if (i < dayCount) {
                        result.push('-');
                        continue;
                    }
                    var sum = 0;
                    for (var j = 0; j < dayCount; j++) {
                        sum += data.values[i - j][1];
                    }
                    result.push((sum / dayCount).toFixed(2));
                }
                return result;
            };
            $("#correlation_1_trend_description").html(rawData.trend_description)
            var correlation_1_option = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: correlation_1_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: correlation_1_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: correlation_1_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: correlation_1_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.mark_line[0]
                            }, {
                                xAxis: rawData.mark_line[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, correlation_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, correlation_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, correlation_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            var correlation_match_1_option = {
                title: {
                    text: rawData.correlation_stock[0].name + "(" + rawData.correlation_stock[0].code + ")",
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: correlation_match_1_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: correlation_match_1_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: correlation_match_1_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: correlation_match_1_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.correlation_match_mark_line_1[0]
                            }, {
                                xAxis: rawData.correlation_match_mark_line_1[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, correlation_match_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, correlation_match_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, correlation_match_1_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            $("#correlation_1_sparkline").sparkline(rawData.correlation_1_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#5eafcd',
                fillColor: '#f4fce1',
                tooltipFormatFieldlist: [],
                tooltipFormatFieldlistKey: 'field'
            }).sparkline(rawData.sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                chartRangeMin: 9.43,
                chartRangeMax: 13.08,
                lineColor: '#ff0000',
                fillColor: false
            });
            $("#correlation_1_r").html(rawData.correlation_stock[0].r);
            for (i = 0; i < 6; i++) {
                var html = "<table class=\"table mb-0\">\n" +
                    "                                    <thead>\n" +
                    "                                    <tr>\n" +
                    "                                        <th>Day.No</th>\n" +
                    "                                        <th>Change</th>\n" +
                    "                                        <th>Open</th>\n" +
                    "                                        <th>High</th>\n" +
                    "                                        <th>Low</th>\n" +
                    "                                        <th>Close</th>\n" +
                    "                                        <th>Volume</th>\n" +
                    "                                    </tr>\n" +
                    "                                    </thead>\n" +
                    "                                    <tbody>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (1 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (2 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 1][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 1][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 1][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 1][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 1][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 1][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (3 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 2][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 2][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 2][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 2][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 2][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 2][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (4 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 3][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 3][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 3][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 3][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 3][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 3][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (5 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 4][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 4][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 4][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 4][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 4][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_1_table_data[5 * i + 4][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    </tbody>\n" +
                    "                                </table>"
                $("#correlation_1_" + (i + 1)).html(html)
            }
            var correlation_2_option = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: correlation_2_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: correlation_2_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: correlation_2_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: correlation_2_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.mark_line[0]
                            }, {
                                xAxis: rawData.mark_line[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, correlation_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, correlation_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, correlation_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            var correlation_match_2_option = {
                title: {
                    text: rawData.correlation_stock[1].name + "(" + rawData.correlation_stock[1].code + ")",
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: correlation_match_2_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: correlation_match_2_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: correlation_match_2_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: correlation_match_2_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.correlation_match_mark_line_2[0]
                            }, {
                                xAxis: rawData.correlation_match_mark_line_2[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, correlation_match_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, correlation_match_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, correlation_match_2_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            $("#correlation_2_sparkline").sparkline(rawData.correlation_2_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#5eafcd',
                fillColor: '#f4fce1',
                tooltipFormatFieldlist: [],
                tooltipFormatFieldlistKey: 'field'
            }).sparkline(rawData.sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                chartRangeMin: 9.43,
                chartRangeMax: 13.08,
                lineColor: '#ff0000',
                fillColor: false
            });
            $("#correlation_2_r").html(rawData.correlation_stock[1].r);
            for (i = 0; i < 6; i++) {
                var html = "<table class=\"table mb-0\">\n" +
                    "                                    <thead>\n" +
                    "                                    <tr>\n" +
                    "                                        <th>Day.No</th>\n" +
                    "                                        <th>Change</th>\n" +
                    "                                        <th>Open</th>\n" +
                    "                                        <th>High</th>\n" +
                    "                                        <th>Low</th>\n" +
                    "                                        <th>Close</th>\n" +
                    "                                        <th>Volume</th>\n" +
                    "                                    </tr>\n" +
                    "                                    </thead>\n" +
                    "                                    <tbody>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (1 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (2 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 1][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 1][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 1][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 1][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 1][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 1][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (3 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 2][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 2][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 2][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 2][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 2][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 2][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (4 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 3][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 3][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 3][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 3][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 3][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 3][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (5 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 4][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 4][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 4][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 4][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 4][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_2_table_data[5 * i + 4][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    </tbody>\n" +
                    "                                </table>"
                $("#correlation_2_" + (i + 1)).html(html)
            }
            var correlation_3_option = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: correlation_3_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: correlation_3_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: correlation_3_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: correlation_3_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.mark_line[0]
                            }, {
                                xAxis: rawData.mark_line[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, correlation_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, correlation_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, correlation_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            var correlation_match_3_option = {
                title: {
                    text: rawData.correlation_stock[2].name + "(" + rawData.correlation_stock[2].code + ")",
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: correlation_match_3_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: correlation_match_3_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: correlation_match_3_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: correlation_match_3_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.correlation_match_mark_line_3[0]
                            }, {
                                xAxis: rawData.correlation_match_mark_line_3[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, correlation_match_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, correlation_match_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, correlation_match_3_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            $("#correlation_3_sparkline").sparkline(rawData.correlation_3_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#5eafcd',
                fillColor: '#f4fce1',
                tooltipFormatFieldlist: [],
                tooltipFormatFieldlistKey: 'field'
            }).sparkline(rawData.sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                chartRangeMin: 9.43,
                chartRangeMax: 13.08,
                lineColor: '#ff0000',
                fillColor: false
            });
            $("#correlation_3_r").html(rawData.correlation_stock[2].r);
            for (i = 0; i < 6; i++) {
                var html = "<table class=\"table mb-0\">\n" +
                    "                                    <thead>\n" +
                    "                                    <tr>\n" +
                    "                                        <th>Day.No</th>\n" +
                    "                                        <th>Change</th>\n" +
                    "                                        <th>Open</th>\n" +
                    "                                        <th>High</th>\n" +
                    "                                        <th>Low</th>\n" +
                    "                                        <th>Close</th>\n" +
                    "                                        <th>Volume</th>\n" +
                    "                                    </tr>\n" +
                    "                                    </thead>\n" +
                    "                                    <tbody>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (1 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (2 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 1][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 1][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 1][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 1][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 1][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 1][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (3 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 2][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 2][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 2][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 2][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 2][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 2][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (4 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 3][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 3][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 3][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 3][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 3][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 3][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (5 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 4][0] + "%</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 4][1] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 4][2] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 4][3] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 4][4] + "</td>\n" +
                    "                                        <td>" + rawData.correlation_3_table_data[5 * i + 4][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    </tbody>\n" +
                    "                                </table>"
                $("#correlation_3_" + (i + 1)).html(html)
            }
            correlation_1.setOption(correlation_1_option);
            correlation_match_1.setOption(correlation_match_1_option)
            correlation_2.setOption(correlation_2_option);
            correlation_match_2.setOption(correlation_match_2_option)
            correlation_3.setOption(correlation_3_option);
            correlation_match_3.setOption(correlation_match_3_option)


        }

        function draw_similarity_history(rawData) {
            var upColor = '#ec0000';
            var downColor = '#00da3c';
            var similarity_history = echarts.init(document.getElementById('similarity_history'));

            function splitData(rawData) {
                var categoryData = [];
                var values = [];
                var volumes = [];
                for (var i = 0; i < rawData.length; i++) {
                    categoryData.push(rawData[i].splice(0, 1)[0]);
                    values.push(rawData[i])
                    volumes.push([i, rawData[i][4], rawData[i][1] > rawData[i][0] ? 1 : -1]);
                }
                return {
                    categoryData: categoryData,
                    values: values,
                    volumes: volumes
                };
            }

            var similarity_history_data = splitData(rawData.similarity_history_match_data);

            function calculateMA(dayCount, data) {
                var result = [];
                for (var i = 0, len = data.values.length; i < len; i++) {
                    if (i < dayCount) {
                        result.push('-');
                        continue;
                    }
                    var sum = 0;
                    for (var j = 0; j < dayCount; j++) {
                        sum += data.values[i - j][1];
                    }
                    result.push((sum / dayCount).toFixed(2));
                }
                return result;
            };
            var similarity_history_option = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20'],
                },

                visualMap: [{
                    show: false,
                    seriesIndex: 0,
                    dimension: 2,
                    pieces: [{
                        value: 1,
                        color: downColor
                    }, {
                        value: -1,
                        color: upColor
                    }]
                }],
                grid: [{
                    left: '50',
                    right: '15',
                    top: '55',
                    bottom: '75',
                    height: '55%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '65%',
                        bottom: '75',
                        height: '23%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: similarity_history_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: similarity_history_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'

                    }
                ],
                yAxis: [{
                    scale: true,
                    splitArea: {
                        show: true
                    }
                }, {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 0,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 0,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'Volume',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        barWidth: '2px',
                        data: similarity_history_data.volumes
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: similarity_history_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markLine: {
                            lineStyle: {
                                color: 'red'
                            },
                            data: [{
                                xAxis: rawData.mark_line[0]
                            }, {
                                xAxis: rawData.mark_line[1]
                            }]
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, similarity_history_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, similarity_history_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, similarity_history_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            $("#similarity_history_sparkline").sparkline(rawData.similarity_history_match_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#5eafcd',
                fillColor: '#f4fce1',
                tooltipFormatFieldlist: [],
                tooltipFormatFieldlistKey: 'field'
            }).sparkline(rawData.sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                chartRangeMin: 9.43,
                chartRangeMax: 13.08,
                lineColor: '#ff0000',
                fillColor: false
            });
            $("#similarity_history_date").html(rawData.match_date[0] + "<br/>" + rawData.match_date[1]);
            for (i = 0; i < 6; i++) {
                var html = "<table class=\"table mb-0\">\n" +
                    "                                    <thead>\n" +
                    "                                    <tr>\n" +
                    "                                        <th>Day.No</th>\n" +
                    "                                        <th>Change</th>\n" +
                    "                                        <th>Open</th>\n" +
                    "                                        <th>High</th>\n" +
                    "                                        <th>Low</th>\n" +
                    "                                        <th>Close</th>\n" +
                    "                                        <th>Volume</th>\n" +
                    "                                    </tr>\n" +
                    "                                    </thead>\n" +
                    "                                    <tbody>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (1 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (2 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 1][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 1][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 1][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 1][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 1][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 1][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (3 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 2][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 2][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 2][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 2][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 2][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 2][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (4 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 3][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 3][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 3][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 3][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 3][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 3][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    <tr>\n" +
                    "                                        <th scope=\"row\">" + (5 + 5 * i) + "</th>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 4][0] + "%</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 4][1] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 4][2] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 4][3] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 4][4] + "</td>\n" +
                    "                                        <td>" + rawData.similarity_history_table_data[5 * i + 4][5] + "</td>\n" +
                    "                                    </tr>\n" +
                    "                                    </tbody>\n" +
                    "                                </table>"
                $("#similarity_history_" + (i + 1)).html(html)
            }
            similarity_history.setOption(similarity_history_option)
        }

        function draw_state_transition(rawData) {
            var state_transition = echarts.init(document.getElementById('state_transition_chart'));

            var upColor = '#FF0099';
            var downColor = '#1AB394';
            var upColor2 = '#FF0099';
            var downColor2 = '#1AB394';

            function splitData(rawData) {
                var categoryData = [];
                var values = [];
                var miniStrong = [];
                var miniWeak = [];
                var Strong = [];
                var Weak = [];
                for (var i = 0; i < rawData.length; i++) {
                    categoryData.push(rawData[i].splice(0, 1)[0]);
                    values.push(rawData[i])
                    miniStrong.push([i, rawData[i][5]]);
                    miniWeak.push([i, rawData[i][6]]);
                    Strong.push([i, rawData[i][7]]);
                    Weak.push([i, rawData[i][8]]);
                }
                return {
                    categoryData: categoryData,
                    values: values,
                    miniStrong: miniStrong,
                    miniWeak: miniWeak,
                    Strong: Strong,
                    Weak: Weak
                };
            }

            var state_transition_data = splitData(rawData.state_transition_line_data)

            function calculateMA(dayCount, data) {
                var result = [];
                for (var i = 0, len = data.values.length; i < len; i++) {
                    if (i < dayCount) {
                        result.push('-');
                        continue;
                    }
                    var sum = 0;
                    for (var j = 0; j < dayCount; j++) {
                        sum += data.values[i - j][1];
                    }
                    result.push((sum / dayCount).toFixed(2));
                }
                return result;
            }

            var html = "<span class=\"progress\"><span class=\"progress-bar progress-bar-green\" style=\"width: " + rawData.today_state_transition_data.s_fall_rate * 100 + "%\">下跌(" + rawData.today_state_transition_data.s_fall_rate * 100 + "%)</span><span class=\"progress-bar progress-bar-gray\" style=\"width: " + rawData.today_state_transition_data.s_maintain_rate * 100 + "%\">持平(" + rawData.today_state_transition_data.s_maintain_rate * 100 + "%)</span><span class=\"progress-bar progress-bar-red\" style=\"width: " + rawData.today_state_transition_data.s_rise_rate * 100 + "%\">上涨(" + rawData.today_state_transition_data.s_rise_rate * 100 + "%)</span></span>"
            $("#s_state_transition_process_bar").html(html)
            html = "<span class=\"progress\"><span class=\"progress-bar progress-bar-green\" style=\"width: " + rawData.today_state_transition_data.l_fall_rate * 100 + "%\">下跌(" + rawData.today_state_transition_data.l_fall_rate * 100 + "%)</span><span class=\"progress-bar progress-bar-gray\" style=\"width: " + rawData.today_state_transition_data.l_maintain_rate * 100 + "%\">持平(" + rawData.today_state_transition_data.l_maintain_rate * 100 + "%)</span><span class=\"progress-bar progress-bar-red\" style=\"width: " + rawData.today_state_transition_data.l_rise_rate * 100 + "%\">上涨(" + rawData.today_state_transition_data.l_rise_rate * 100 + "%)</span></span>"
            $("#l_state_transition_process_bar").html(html)
            html = "<table class=\"table mb-0 text-center\">\n" +
                "                            <thead>\n" +
                "                            <tr style=\"font-weight: bold\">\n" +
                "                                <th>下跌（跌超过1%）</th>\n" +
                "                                <th>持平[-1%-1%]</th>\n" +
                "                                <th>上涨（涨超过1%）</th>\n" +
                "                            </tr>\n" +
                "                            </thead>\n" +
                "                            <tbody>\n" +
                "                            <tr>\n" +
                "                                <td style=\"color: " + downColor + "\">" + rawData.today_state_transition_data.s_fall_rate * 100 + "%</td>\n" +
                "                                <td style=\"color: #B3B3B3\">" + rawData.today_state_transition_data.s_maintain_rate * 100 + "%</td>\n" +
                "                                <td style=\"color:" + upColor + ";\">" + rawData.today_state_transition_data.s_rise_rate * 100 + "%</td>\n" +
                "                            </tr>\n" +
                "                            </tbody>\n" +
                "                        </table>"
            $("#s_state_transition_table").html(html)
            html = "<table class=\"table mb-0 text-center\">\n" +
                "                            <thead>\n" +
                "                            <tr style=\"font-weight: bold\">\n" +
                "                                <th>下跌（跌超过2%）</th>\n" +
                "                                <th>窄幅波动[-2%-2%]</th>\n" +
                "                                <th>上涨（涨超过2%）</th>\n" +
                "                            </tr>\n" +
                "                            </thead>\n" +
                "                            <tbody>\n" +
                "                            <tr>\n" +
                "                                <td style=\"color: " + downColor + "\">" + rawData.today_state_transition_data.l_fall_rate * 100 + "%</td>\n" +
                "                                <td style=\"color: #B3B3B3\">" + rawData.today_state_transition_data.l_maintain_rate * 100 + "%</td>\n" +
                "                                <td style=\"color:" + upColor + ";\">" + rawData.today_state_transition_data.l_rise_rate * 100 + "%</td>\n" +
                "                            </tr>\n" +
                "                            </tbody>\n" +
                "                        </table>"
            $("#l_state_transition_table").html(html)

            $("#s_state_transition_chart").sparkline(rawData.s_rise_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#ff0000',
                fillColor: '#ffffff'
            }).sparkline(rawData.s_fall_sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#1ab394',
                fillColor: false
            })
            $("#l_state_transition_chart").sparkline(rawData.l_rise_sparkline_data, {
                type: 'line',
                width: '100%',
                height: '80',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#ff0000',
                fillColor: '#ffffff'
            }).sparkline(rawData.l_fall_sparkline_data, {
                composite: true,
                type: 'line',
                spotColor: false,
                minSpotColor: false,
                maxSpotColor: false,
                lineColor: '#1ab394',
                fillColor: false
            })
            var state_transition_option = {
                title: {
                    text: '{{ stock.name }}',
                    left: 10
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    }
                },
                axisPointer: {
                    link: {xAxisIndex: 'all'},
                    label: {
                        backgroundColor: '#777'
                    }
                },
                legend: {
                    left: 'right',
                    data: ['日K线', 'MA5', 'MA10', 'MA20', 'MA30', 'MA60', 'MA120'],
                    selected: {'MA10': false, 'MA30': false}
                },
                grid: [{
                    left: '50',
                    right: '15',
                    top: '35',
                    bottom: '75',
                    height: '45%'
                },
                    {
                        left: '50',
                        right: '15',
                        top: '57%',
                        bottom: '75',
                        height: '13%'
                    }
                    ,
                    {
                        left: '50',
                        right: '15',
                        top: '76%',
                        bottom: '75',
                        height: '13%'
                    }
                ],
                xAxis: [{
                    type: 'category',
                    data: state_transition_data.categoryData,
                    scale: true,
                    boundaryGap: false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: state_transition_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'
                    },
                    {
                        type: 'category',
                        gridIndex: 2,
                        data: state_transition_data.categoryData,
                        scale: true,
                        boundaryGap: false,
                        axisLine: {onZero: false},
                        axisTick: {show: false},
                        splitLine: {show: false},
                        axisLabel: {show: false},
                        splitNumber: 20,
                        min: 'dataMin',
                        max: 'dataMax'
                    }
                ],
                yAxis: [
                    {
                        scale: true,
                        splitArea: {
                            show: true
                        }
                    },
                    {
                        name: '小幅方式强弱线 ',
                        nameLocation: 'end',
                        scale: true,
                        gridIndex: 1,
                        splitNumber: 2,
                        axisLabel: {show: true},
                        axisLine: {show: true},
                        axisTick: {show: true},
                        splitLine: {show: false}
                    },
                    {
                        name: '大幅方式强弱线 ',
                        nameLocation: 'end',
                        scale: true,
                        gridIndex: 2,
                        splitNumber: 2,
                        axisLabel: {show: true},
                        axisLine: {show: true},
                        axisTick: {show: true},
                        splitLine: {show: false}
                    }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 45,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 2],
                        type: 'slider',
                        top: '90%',
                        start: 45,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'miniStrong',
                        type: 'line',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5, color: upColor2}
                        },
                        data: state_transition_data.miniStrong
                    },
                    {
                        name: 'miniWeak',
                        type: 'line',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5, color: downColor2}
                        },
                        data: state_transition_data.miniWeak
                    },
                    {
                        name: 'Strong',
                        type: 'line',
                        xAxisIndex: 2,
                        yAxisIndex: 2,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5, color: upColor}
                        },
                        data: state_transition_data.Strong
                    },
                    {
                        name: 'Weak',
                        type: 'line',
                        xAxisIndex: 2,
                        yAxisIndex: 2,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5, color: downColor}
                        },
                        data: state_transition_data.Weak
                    },
                    {
                        name: '日K线',
                        type: 'candlestick',
                        data: state_transition_data.values,
                        itemStyle: {
                            normal: {
                                color: upColor,
                                color0: downColor,
                                borderColor: null,
                                borderColor0: null
                            }
                        },
                        markPoint: {
                            label: {
                                normal: {
                                    formatter: function (param) {
                                        return param != null ? Math.round(param.value) : '';
                                    }
                                }
                            },
                            data: [

                                {
                                    name: '最高点',
                                    type: 'max',
                                    valueDim: 'highest'
                                },
                                {
                                    name: '最低点',
                                    type: 'min',
                                    valueDim: 'lowest'
                                }
                            ],
                            tooltip: {
                                formatter: function (param) {
                                    return param.name + '<br>' + (param.data.coord || '');
                                }
                            }
                        }
                    },
                    {
                        name: 'MA5',
                        type: 'line',
                        data: calculateMA(5, state_transition_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA10',
                        type: 'line',
                        data: calculateMA(10, state_transition_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA20',
                        type: 'line',
                        data: calculateMA(20, state_transition_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA30',
                        type: 'line',
                        data: calculateMA(30, state_transition_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA60',
                        type: 'line',
                        data: calculateMA(60, state_transition_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    },
                    {
                        name: 'MA120',
                        type: 'line',
                        data: calculateMA(120, state_transition_data),
                        smooth: true,
                        showAllSymbol: false,
                        lineStyle: {
                            normal: {opacity: 0.5}
                        }
                    }
                ]
            };
            state_transition.setOption(state_transition_option)
        }


    </script>
{% endblock %}